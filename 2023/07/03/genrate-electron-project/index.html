<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <link rel="alternate icon" type="image/png" href="/img/favicon.png">
    <title>æƒ³è‡ªç”± | </title>
    
<link rel="stylesheet" href="/css/reset.css">

    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/css/markdown.css">

    
<link rel="stylesheet" href="/css/fonts.css">

<meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <div class="paper">
            <div class="paper-main">
                
                    <div class="post-header">
    <a class="logo" href="/">æƒ³è‡ªç”±</a>
    <a class="go-home" href="/">
        <svg width="8" height="14" viewBox="0 0 8 14">
            <path d="M7 1L1 7l6 6" stroke="#000" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </a>
</div>
                
                <div class="post-main">

    
    
        <div class="post-main-title">
            ä»é›¶æ„å»ºä¸€ä¸ª electron é¡¹ç›®
        </div>
        <div class="post-meta">
            2023-07-03
        </div>
        <div class="post-md">
            <p>æœ¬æ–‡å°†è®°å½•æˆ‘æ˜¯å¦‚ä½•ä»é›¶å¼€å§‹å®Œæˆä¸€ä¸ªåŸºäº electron çš„æ¡Œé¢åº”ç”¨çš„åˆå§‹åŒ–</p>
<h1 id="ä¸€ã€åˆå§‹åŒ–-npm-é¡¹ç›®"><a href="#ä¸€ã€åˆå§‹åŒ–-npm-é¡¹ç›®" class="headerlink" title="ä¸€ã€åˆå§‹åŒ– npm é¡¹ç›®"></a>ä¸€ã€åˆå§‹åŒ– npm é¡¹ç›®</h1><p>electron é¡¹ç›®åŸºäº nodeï¼Œæ‰€ä»¥åœ¨æ–°å»ºä¸€ä¸ªç©ºç›®å½•åéœ€è¦ä½¿ç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure>

<p>å°†å…¶åˆå§‹åŒ–ä¸ºä¸€ä¸ª npm &#x2F; node é¡¹ç›®è¿›è¡Œç®¡ç†ã€‚</p>
<h1 id="äºŒã€å®ç°-MVP"><a href="#äºŒã€å®ç°-MVP" class="headerlink" title="äºŒã€å®ç° MVP"></a>äºŒã€å®ç° MVP</h1><p>æœ¬ç« å†…å®¹ä¸ºè®©é¡¹ç›®èƒ½ä»¥æœ€å°çš„ä¾èµ–å¯åŠ¨</p>
<p>å‚è€ƒæ–‡æ¡£å†…å®¹: <a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/tutorial/tutorial-first-app">https://www.electronjs.org/zh/docs/latest/tutorial/tutorial-first-app</a></p>
<h2 id="2-1-å®‰è£…ä¾èµ–"><a href="#2-1-å®‰è£…ä¾èµ–" class="headerlink" title="2.1 å®‰è£…ä¾èµ–"></a>2.1 å®‰è£…ä¾èµ–</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install electron</span><br></pre></td></tr></table></figure>

<p>æœ€å°ä¾èµ–åªéœ€è¦ electron å°±è¶³å¤Ÿå¯åŠ¨ä¸€ä¸ªæ¡Œé¢åº”ç”¨ã€‚</p>
<h2 id="2-2-ç¼–å†™æœ€åŸºç¡€çš„ä»£ç "><a href="#2-2-ç¼–å†™æœ€åŸºç¡€çš„ä»£ç " class="headerlink" title="2.2 ç¼–å†™æœ€åŸºç¡€çš„ä»£ç "></a>2.2 ç¼–å†™æœ€åŸºç¡€çš„ä»£ç </h2><h3 id="2-2-1-æ¸²æŸ“ä»£ç ç¼–å†™"><a href="#2-2-1-æ¸²æŸ“ä»£ç ç¼–å†™" class="headerlink" title="2.2.1 æ¸²æŸ“ä»£ç ç¼–å†™"></a>2.2.1 æ¸²æŸ“ä»£ç ç¼–å†™</h3><p>æ¸²æŸ“çš„å†…å®¹åŸºæœ¬ç­‰åŒäº web é‚£ä¸€å¥—ï¼ˆå¯ä»¥ç®€å•ç†è§£ä¸ºåœ¨æ¡Œé¢åº”ç”¨é‡Œå†…åµŒäº†ä¸€ä¸ªæµè§ˆå™¨ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥æŠŠå¼€å‘ web çš„ç»éªŒå®Œå…¨å¹³ç§»è¿‡æ¥ä½¿ç”¨ã€‚</p>
<p>ä¾‹å¦‚åœ¨æ ¹ç›®å½•æ–°å»ºä¸€ä¸ª index.htmlï¼Œå†…å®¹å¦‚ä¸‹:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span></span></span><br><span class="line"><span class="tag">      <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">content</span>=<span class="string">&quot;default-src &#x27;self&#x27;; script-src &#x27;self&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span></span></span><br><span class="line"><span class="tag">      <span class="attr">http-equiv</span>=<span class="string">&quot;X-Content-Security-Policy&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">content</span>=<span class="string">&quot;default-src &#x27;self&#x27;; script-src &#x27;self&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello from Electron renderer!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello from Electron renderer!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>ğŸ‘‹<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-2-æ¡Œé¢åº”ç”¨é€»è¾‘ä»£ç ç¼–å†™"><a href="#2-2-2-æ¡Œé¢åº”ç”¨é€»è¾‘ä»£ç ç¼–å†™" class="headerlink" title="2.2.2 æ¡Œé¢åº”ç”¨é€»è¾‘ä»£ç ç¼–å†™"></a>2.2.2 æ¡Œé¢åº”ç”¨é€»è¾‘ä»£ç ç¼–å†™</h3><p>ç¼–å†™é¡¹ç›® package.json ä¸­çš„ main æ–‡ä»¶</p>
<blockquote>
<p>ä¾‹å¦‚ package.json ä¸­çš„ main å­—æ®µä¸º index.jsï¼Œåˆ™å¯¹åº”é¡¹ç›®ç›®å½•ä¸‹çš„ index.js æ–‡ä»¶</p>
</blockquote>
<p>ä»£ç å†…å®¹å¦‚ä¸‹:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createWindow</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> win = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  win.<span class="title function_">loadFile</span>(<span class="string">&quot;index.html&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">whenReady</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">createWindow</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å†…å®¹ä¸ºé€šè¿‡<code>app.whenReady</code>æ–¹æ³•å®Œæˆ electron å¯¹æ¡Œé¢åº”ç”¨çš„åˆå§‹åŒ–å¯åŠ¨ï¼Œä¹‹åé€šè¿‡<code>BrowserWindow</code>å¯¹è±¡å°†åˆšåˆšç¼–å†™çš„æ¸²æŸ“ä»£ç è¿æ¥åˆ°æ¡Œé¢åº”ç”¨ä¸­ã€‚</p>
<h2 id="2-3-å¯åŠ¨åº”ç”¨"><a href="#2-3-å¯åŠ¨åº”ç”¨" class="headerlink" title="2.3 å¯åŠ¨åº”ç”¨"></a>2.3 å¯åŠ¨åº”ç”¨</h2><p>åœ¨ package.json ä¸­åŠ å…¥è„šæœ¬</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;electron .&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œ <code>npm run dev</code> å¯åŠ¨åå³å¯çœ‹åˆ° html ä¸­çš„å†…å®¹è¾“å‡ºåˆ°äº†ä¸€ä¸ªæ–°å¯åŠ¨çš„æ¡Œé¢åº”ç”¨ä¸Šã€‚</p>
<h2 id="2-4-ä»£ç ç†è§£"><a href="#2-4-ä»£ç ç†è§£" class="headerlink" title="2.4 ä»£ç ç†è§£"></a>2.4 ä»£ç ç†è§£</h2><p>ä¸Šé¢ç¼–å†™çš„ä»£ç è®©æˆ‘æƒ³åˆ°äº†ç”¨äºæµ‹è¯•å’Œçˆ¬è™«çš„æ— å¤´æµè§ˆå™¨çš„æ‰§è¡Œé“¾è·¯:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¼–å†™è„šæœ¬ -&gt; ä½¿ç”¨è¯¥è„šæœ¬å”¤èµ·ä¸€ä¸ªæµè§ˆå™¨ -&gt; ä½¿ç”¨è¯¥è„šæœ¬æ§åˆ¶æµè§ˆå™¨çš„è¡Œä¸º</span><br></pre></td></tr></table></figure>

<p>éƒ½æ˜¯é€šè¿‡è„šæœ¬(<code>main.js</code>)å¯åŠ¨ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹æ¥æ§åˆ¶æµè§ˆå™¨çš„å†…å®¹å’Œè¡Œä¸ºçš„æ“ä½œã€‚</p>
<h1 id="ä¸‰ã€ç‰ˆæœ¬æ‰“åŒ…ã€å‘å¸ƒä¸æ›´æ–°"><a href="#ä¸‰ã€ç‰ˆæœ¬æ‰“åŒ…ã€å‘å¸ƒä¸æ›´æ–°" class="headerlink" title="ä¸‰ã€ç‰ˆæœ¬æ‰“åŒ…ã€å‘å¸ƒä¸æ›´æ–°"></a>ä¸‰ã€ç‰ˆæœ¬æ‰“åŒ…ã€å‘å¸ƒä¸æ›´æ–°</h1><p>æ¡Œé¢åº”ç”¨ä¸ web åº”ç”¨ä¸€ä¸ªå¾ˆå¤§çš„åŒºåˆ«å°±æ˜¯å®ƒçš„ç‰ˆæœ¬æ›´æ–°ä¸èƒ½ä¾èµ–äº http å› è€Œåšä¸åˆ°å®Œå…¨è‡ªåŠ¨åŒ–ã€‚æ ¹æ®ä¹‹å‰å¯¹å®‰å“ã€ios åº”ç”¨çš„äº†è§£ï¼Œæ¡Œé¢åº”ç”¨åº”è¯¥ä¼šæœ‰ä¸€ä¸ªèµ„æºåˆ†å‘å¹³å°ï¼ˆè‡ªå»ºæˆ–ç¬¬ä¸‰æ–¹ï¼‰ï¼Œåº”ç”¨ä¼šåœ¨å¯åŠ¨æ—¶è¯·æ±‚è¿™ä¸ªèµ„æºåˆ†å‘å¹³å°ä»¥æ ¡éªŒç‰ˆæœ¬ï¼Œå†æ ¹æ®åˆ†å‘å¹³å°çš„èƒ½åŠ›å¯¹â€œç‰ˆæœ¬æ›´æ–°â€è¿™ä¸ªåŠ¨ä½œè¿›è¡Œå…¨é‡æˆ–å¢é‡çš„èµ„æºä¸‹è½½ä¸æ›¿æ¢ã€‚</p>
<h2 id="3-1-å·¥å…·çš„é€‰æ‹©"><a href="#3-1-å·¥å…·çš„é€‰æ‹©" class="headerlink" title="3.1 å·¥å…·çš„é€‰æ‹©"></a>3.1 å·¥å…·çš„é€‰æ‹©</h2><p>å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼Œåœ¨ä¸€ä¸ªç§°ä¸ä¸Šååˆ†ç†Ÿæ‚‰çš„é¢†åŸŸï¼Œç›´æ¥ä½¿ç”¨ç°å­˜çš„ä¸‰æ–¹å·¥å…·è¿œæ¯”è‡ªå·±é€ è½®å­æ¥çš„æœ‰æ€§ä»·æ¯”ã€‚<br>electron çš„æ„å»ºå‘å¸ƒå·¥å…·ç›®å‰ä¸»è¦æœ‰:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.electronforge.io/">electron-forge</a></li>
<li><a target="_blank" rel="noopener" href="https://www.electron.build/">electron-builder</a></li>
</ol>
<p>åœ¨ 2017 å¹´æ—¶ï¼Œä¸¤è€…è¿˜æœ‰å¾ˆå¤§çš„åŠŸèƒ½ä¸Šçš„åˆ†æ­§ï¼Œå…·<code>electron-builder</code>å¼€å‘è€…è‡ªå·±<a target="_blank" rel="noopener" href="https://github.com/electron-userland/electron-builder/issues/1193">æè¿°</a>, <code>electron-builder</code>æ˜¯ä¸€ä¸ªæ›´ä¸“æ³¨äº electron é¡¹ç›®æ„å»ºçš„è„šæœ¬å·¥å…·ï¼Œè€Œ<code>electron-forge</code>æ›´åƒæ˜¯ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„ ideã€‚</p>
<p>ä½†æ—¶è¿‡å¢ƒè¿ï¼Œæ²§æµ·æ¡‘ç”°ï¼Œå°±åƒ<code>rollup</code>ä¸<code>webpack</code>çš„æ®Šé€”åŒå½’ä¸€æ ·ï¼Œåœ¨ç»å†äº†è¿™ 6 å¹´çš„é£é£é›¨é›¨åï¼Œä¸¤è€…åœ¨åŠŸèƒ½ä¸Šå·²ç»å¾ˆéš¾å†æ‰¾å‡ºå¤§çš„åŒºåˆ«ï¼ŒåŸºæœ¬ä½ æ”¯æŒçš„æˆ‘ä¹Ÿéƒ½æ”¯æŒï¼Œä½ èƒ½åšåˆ°æˆ‘ä¹Ÿèƒ½åšåˆ°ï¼Œæ— éå°±æ˜¯è°ç”¨ç€é¡ºæ‰‹çš„äº‹äº†ã€‚</p>
<p>æ‰€ä»¥å°±å¦‚ <code>redux</code>&#x2F;<code>mobx</code>&#x2F;<code>recoil</code>ä½œä¸º react çš„çŠ¶æ€ç®¡ç†å·¥å…·é™¤äº†ä½¿ç”¨çš„æ–¹å¼æœ‰æ‰€åŒºåˆ«ï¼Œèƒ½å®ç°çš„åŠŸèƒ½éƒ½æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚<code>electron-forge</code> ä¸ <code>electron-builder</code> ä¹Ÿæ˜¯èƒ½å®Œå…¨å¹³æ›¿çš„ã€‚</p>
<p>æˆ‘å…ˆå°è¯•äº† <code>electron-builder</code>ï¼Œä½†ä»–å› ä¸ºå†…éƒ¨ä¾èµ–ç‰ˆæœ¬ä¸å¯¹é½çš„ç‰ˆæœ¬å¯¼è‡´ <code>electron-builder start</code> æ— æ³•è¿è¡Œï¼Œå¾ˆéš¾è®©äººè®¤ä¸ºä»–æ˜¯ä¸€ä¸ªç¨³å®šçš„ç³»ç»Ÿï¼Œæ‰€ä»¥æˆ‘å†³å®šä½¿ç”¨<code>electron-forge</code>è¿›è¡Œå¼€å‘ã€‚</p>
<h2 id="3-2-ä¸ºé¡¹ç›®æ¥å…¥-electron-forge"><a href="#3-2-ä¸ºé¡¹ç›®æ¥å…¥-electron-forge" class="headerlink" title="3.2 ä¸ºé¡¹ç›®æ¥å…¥ electron-forge"></a>3.2 ä¸ºé¡¹ç›®æ¥å…¥ electron-forge</h2><h2 id="3-2-1-ä½¿ç”¨-cli-æ¥å…¥"><a href="#3-2-1-ä½¿ç”¨-cli-æ¥å…¥" class="headerlink" title="3.2.1 ä½¿ç”¨ cli æ¥å…¥"></a>3.2.1 ä½¿ç”¨ cli æ¥å…¥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev @electron-forge/cli</span><br><span class="line">npx electron-forge import</span><br></pre></td></tr></table></figure>

<h2 id="3-2-2-ä½¿ç”¨æ–°çš„å‘½ä»¤å¯åŠ¨é¡¹ç›®"><a href="#3-2-2-ä½¿ç”¨æ–°çš„å‘½ä»¤å¯åŠ¨é¡¹ç›®" class="headerlink" title="3.2.2 ä½¿ç”¨æ–°çš„å‘½ä»¤å¯åŠ¨é¡¹ç›®"></a>3.2.2 ä½¿ç”¨æ–°çš„å‘½ä»¤å¯åŠ¨é¡¹ç›®</h2><p>æ‰§è¡Œå®Œä¸Šè¿°å‘½ä»¤åå¯ä»¥å‘ç° package.json ä¸­çš„ script å­—æ®µå†…å®¹è¢«æ›¿æ¢æˆäº† 3 ä¸ªåŸºäº electron-forge è„šæœ¬çš„å‘½ä»¤ã€‚<br>åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨åå¾—åˆ°å’Œæ¥å…¥ electron-forget ä¸€æ ·çš„è¾“å‡ºã€‚</p>
<h2 id="3-3-ä½¿ç”¨-electron-forge-è¿›è¡Œæ‰“åŒ…"><a href="#3-3-ä½¿ç”¨-electron-forge-è¿›è¡Œæ‰“åŒ…" class="headerlink" title="3.3 ä½¿ç”¨ electron-forge è¿›è¡Œæ‰“åŒ…"></a>3.3 ä½¿ç”¨ electron-forge è¿›è¡Œæ‰“åŒ…</h2><p>æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run make</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°äº§ç‰©æ–‡ä»¶å¤¹<code>out</code>ï¼Œå…¶ä¸­<code>out/make/xxx/xxx/xxx.zip</code>å³å¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ã€‚</p>
<h2 id="3-4-ä½¿ç”¨-electron-forge-è¿›è¡Œå‘å¸ƒä¸æ¨é€"><a href="#3-4-ä½¿ç”¨-electron-forge-è¿›è¡Œå‘å¸ƒä¸æ¨é€" class="headerlink" title="3.4 ä½¿ç”¨ electron-forge è¿›è¡Œå‘å¸ƒä¸æ¨é€"></a>3.4 ä½¿ç”¨ electron-forge è¿›è¡Œå‘å¸ƒä¸æ¨é€</h2><h3 id="3-4-1-ä½¿ç”¨-electron-release-server-æ­å»ºæ›´æ–°æœåŠ¡å™¨"><a href="#3-4-1-ä½¿ç”¨-electron-release-server-æ­å»ºæ›´æ–°æœåŠ¡å™¨" class="headerlink" title="3.4.1 ä½¿ç”¨ electron-release-server æ­å»ºæ›´æ–°æœåŠ¡å™¨"></a>3.4.1 ä½¿ç”¨ electron-release-server æ­å»ºæ›´æ–°æœåŠ¡å™¨</h3><p>åœ¨ <a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/tutorial/updates#%E7%AC%AC%E4%B8%80%E6%AD%A5%E9%83%A8%E7%BD%B2%E6%9B%B4%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8">electron æ–‡æ¡£</a>ä¸­èƒ½çœ‹åˆ°å®˜æ–¹æ¨èäº†å‡ æ¬¾å¯ç”¨ä½œæ›´æ–°æœåŠ¡å™¨çš„å¼€æºè½¯ä»¶ã€‚ç»¼åˆè§‚å¯Ÿåé€‰æ‹© <code>electron-release-server</code>ã€‚</p>
<p><strong>1ã€é¦–å…ˆæˆ‘ä»¬ä¸º electron-release-server é¡¹ç›®æ„å»ºé•œåƒ</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ArekSredzki/electron-release-server/tree/master">electron-release-server é¡¹ç›®</a>ä¸­è‡ªå¸¦äº† Dockerfileï¼Œç¨åŠ ä¿®æ”¹åï¼ˆä¸»è¦æ˜¯é’ˆå¯¹ç½‘ç»œä¼Ÿå¤§å¢™ï¼‰å³å¯æ„å»ºå‡ºæˆ‘ä»¬éœ€è¦çš„é•œåƒã€‚</p>
<blockquote>
<p>æ³¨æ„: è¯¥å®¹å™¨çš„å¯åŠ¨ä¾èµ– PostgreSQLï¼Œé…ç½®å†…å®¹çœ‹ <code>config/docker.js</code></p>
</blockquote>
<p><strong>2ã€ä¹‹åæˆ‘ä»¬é€šè¿‡ electron-release-server æä¾›çš„ç«™ç‚¹è¿›è¡Œæ“ä½œ</strong></p>
<p>è®¿é—®å¯åŠ¨ç«¯å£å¯¹åº”çš„ web æœåŠ¡å³å¯è®¿é—® <code>electron-release-server</code>ã€‚</p>
<p>æˆ‘ä»¬ä¿®æ”¹<code>forge.config.js</code>ä¸­çš„ makers å­—æ®µæ–°å¢å†…å®¹:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;@electron-forge/maker-dmg&quot;</span>,</span><br><span class="line">    <span class="attr">config</span>: &#123;</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&quot;./assets/dmg-background.png&quot;</span>,</span><br><span class="line">    <span class="attr">format</span>: <span class="string">&quot;ULFO&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run make</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°åœ¨ <code>out/make</code> ç›®å½•ä¸‹ç”Ÿæˆäº† <code>.dmg</code> çš„èµ„æºã€‚å°†è¯¥æ–‡ä»¶ä¸Šä¼ åˆ° <code>electron-release-server</code> çš„ç®¡ç†åå°å¹¶æŒ‡å®šæ“ä½œç³»ç»Ÿä¸º OSX åå³å¯ä»<code>electron-release-server</code> ä¸»é¡µä¸‹è½½ç³»ç»Ÿå¯¹åº”ç‰ˆæœ¬çš„åº”ç”¨ã€‚</p>
<blockquote>
<p>æˆ‘é€šè¿‡ä¸‹è½½å®‰è£…çš„åº”ç”¨æ‰“å¼€æ—¶ä¼šæŠ¥é”™: â€œåº”ç”¨å·²æŸå xxxxâ€ çš„æŠ¥é”™ï¼Œè§£å†³æ–¹æ³•æ˜¯: <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/99489849">https://zhuanlan.zhihu.com/p/99489849</a></p>
</blockquote>
<p><strong>3ã€æœ€åæˆ‘ä»¬éœ€è¦æ¥å…¥æ›´æ–°èƒ½åŠ›</strong></p>
<p>é¦–å…ˆä»<code>electron-release-server</code>æ–‡æ¡£å¯ä»¥çœ‹åˆ°æ›´æ–°çš„ url æ˜¯:</p>
<ol>
<li>&#x2F;update&#x2F;:platform&#x2F;:version[&#x2F;:channel]</li>
<li>&#x2F;update&#x2F;flavor&#x2F;:flavor&#x2F;:platform&#x2F;:version[&#x2F;:channel]</li>
</ol>
<p>æ ¹æ® <a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/tutorial/updates#%E4%BD%BF%E7%94%A8%E5%85%B6%E4%BB%96%E6%9B%B4%E6%96%B0%E6%9C%8D%E5%8A%A1">electron çš„æ–‡æ¡£</a>æä¾›çš„è‡ªåŠ¨æ›´æ–°çš„æ–¹æ¡ˆï¼Œä½¿ç”¨ electron çš„ autoUpdater api è¿›è¡Œæ£€æŸ¥ã€ä¸‹è½½ã€é‡å¯å¹¶æ›´æ–°ã€‚</p>
<p>åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­æ–°å»ºä¸€ä¸ª<code>update.ts</code>å†…å®¹å¦‚ä¸‹(æ­¤æ—¶æˆ‘å·²ç»æŠŠé¡¹ç›®ä» js è¿ç§»åˆ°äº† tsï¼Œè¿™å—æ¯”è¾ƒç®€å•ä¸”ä¸ electron æ— å…³ä¸åšå±•å¼€):</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  app,</span><br><span class="line">  <span class="title class_">BrowserWindow</span>,</span><br><span class="line">  ipcMain,</span><br><span class="line">  dialog,</span><br><span class="line">  autoUpdater,</span><br><span class="line">  <span class="title class_">MessageBoxOptions</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;electron&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">UpdateManager</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="attr">instance</span>: <span class="title class_">UpdateManager</span> = <span class="keyword">new</span> <span class="title class_">UpdateManager</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="title function_">getInstance</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">instance</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  baseUrl = <span class="string">&quot;http://localhost:8080&quot;</span>;</span><br><span class="line">  flavorName = <span class="string">&quot;wangchao-test&quot;</span>;</span><br><span class="line">  <span class="attr">mainWindow</span>: <span class="title class_">BrowserWindow</span> | <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">sendUpdateMessage</span>(<span class="params">text: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">mainWindow</span>?.<span class="property">webContents</span>.<span class="title function_">send</span>(<span class="string">&quot;update-message&quot;</span>, text);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">init</span>(<span class="params"><span class="variable language_">window</span>: BrowserWindow</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ipcMain-update,init&quot;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">mainWindow</span> = <span class="variable language_">window</span>;</span><br><span class="line">    <span class="keyword">let</span> platform = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> arch = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (process.<span class="property">platform</span> === <span class="string">&quot;darwin&quot;</span>) &#123;</span><br><span class="line">      platform = <span class="string">&quot;osx&quot;</span>;</span><br><span class="line">      <span class="keyword">if</span> (process.<span class="property">arch</span> === <span class="string">&quot;arm64&quot;</span>) &#123;</span><br><span class="line">        arch = <span class="string">&quot;arm64&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        arch = <span class="string">&quot;64&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.<span class="property">platform</span> === <span class="string">&quot;win32&quot;</span>) &#123;</span><br><span class="line">      platform = <span class="string">&quot;windows&quot;</span>;</span><br><span class="line">      <span class="keyword">if</span> (process.<span class="property">arch</span> === <span class="string">&quot;x64&quot;</span>) &#123;</span><br><span class="line">        arch = <span class="string">&quot;64&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        arch = <span class="string">&quot;32&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.<span class="property">platform</span> === <span class="string">&quot;linux&quot;</span>) &#123;</span><br><span class="line">      platform = <span class="string">&quot;linux&quot;</span>;</span><br><span class="line">      <span class="keyword">if</span> (process.<span class="property">arch</span> === <span class="string">&quot;x64&quot;</span> || process.<span class="property">arch</span> === <span class="string">&quot;ppc64&quot;</span>) &#123;</span><br><span class="line">        arch = <span class="string">&quot;64&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        arch = <span class="string">&quot;32&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> feedUrl =</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">baseUrl</span> +</span><br><span class="line">      <span class="string">&quot;/update/flavor/&quot;</span> +</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">flavorName</span> +</span><br><span class="line">      <span class="string">&quot;/&quot;</span> +</span><br><span class="line">      platform +</span><br><span class="line">      <span class="string">&quot;_&quot;</span> +</span><br><span class="line">      arch +</span><br><span class="line">      <span class="string">&quot;/&quot;</span> +</span><br><span class="line">      app.<span class="title function_">getVersion</span>() +</span><br><span class="line">      <span class="string">&quot;/stable&quot;</span>;</span><br><span class="line">    autoUpdater.<span class="title function_">setFeedURL</span>(&#123; <span class="attr">url</span>: feedUrl &#125;);</span><br><span class="line"></span><br><span class="line">    autoUpdater.<span class="title function_">on</span>(<span class="string">&quot;error&quot;</span>, <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ipcMain-update,error:&quot;</span> + error);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">sendUpdateMessage</span>(&#123; <span class="attr">cmd</span>: <span class="string">&quot;error&quot;</span>, <span class="attr">message</span>: error &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    autoUpdater.<span class="title function_">on</span>(<span class="string">&quot;update-not-available&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ipcMain-update,update-not-available&quot;</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">sendUpdateMessage</span>(&#123;</span><br><span class="line">        <span class="attr">cmd</span>: <span class="string">&quot;update-not-available&quot;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;has not found any updates&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    autoUpdater.<span class="title function_">on</span>(<span class="string">&quot;update-available&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ipcMain-update,update-available&quot;</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">sendUpdateMessage</span>(&#123;</span><br><span class="line">        <span class="attr">cmd</span>: <span class="string">&quot;update-available&quot;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;find new version&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    autoUpdater.<span class="title function_">on</span>(<span class="string">&quot;update-downloaded&quot;</span>, <span class="function">(<span class="params">event, releaseNotes, releaseName</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ipcMain-update,update-downloaded:&quot;</span> + event);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">sendUpdateMessage</span>(&#123;</span><br><span class="line">        <span class="attr">cmd</span>: <span class="string">&quot;update-downloaded&quot;</span>,</span><br><span class="line">        <span class="attr">message</span>: &#123;</span><br><span class="line">          <span class="attr">releaseNotes</span>: releaseNotes,</span><br><span class="line">          <span class="attr">releaseName</span>: releaseName,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">dialogOpts</span>: <span class="title class_">MessageBoxOptions</span> = &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;info&quot;</span>,</span><br><span class="line">        <span class="attr">buttons</span>: [<span class="string">&quot;ç¡®å®š&quot;</span>, <span class="string">&quot;ç¨å&quot;</span>],</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;ç‰ˆæœ¬æ›´æ–°&quot;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;å‘ç°æ–°ç‰ˆæœ¬:&quot;</span> + releaseName,</span><br><span class="line">        <span class="attr">detail</span>: <span class="string">&quot;æ–°ç‰ˆæœ¬å·²ç»ä¸‹è½½å®Œæˆï¼Œæ˜¯å¦ç°åœ¨é‡å¯?&quot;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      dialog.<span class="title function_">showMessageBox</span>(dialogOpts).<span class="title function_">then</span>(<span class="function">(<span class="params">returnValue</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (returnValue.<span class="property">response</span> === <span class="number">0</span>) &#123;</span><br><span class="line">          autoUpdater.<span class="title function_">quitAndInstall</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    ipcMain.<span class="title function_">on</span>(<span class="string">&quot;checkForUpdate&quot;</span>, <span class="function">(<span class="params">event, args</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ipcMain-update,checkForUpdate&quot;</span>);</span><br><span class="line">      autoUpdater.<span class="title function_">checkForUpdates</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç çš„æ ¸å¿ƒæ˜¯è®¡ç®—<code>feedUrl</code>éƒ¨åˆ†ï¼Œå…¶ä»–éƒ½ä¸ electron æ–‡æ¡£çš„å†…å®¹ä¸€è‡´ã€‚</p>
<p>å¹¶åœ¨å…¥å£æ–‡ä»¶ï¼ˆ2.2.2 ä¸­ç¼–å†™çš„ jsï¼‰æ¥å…¥<code>update.ts</code>çš„é€»è¾‘:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; app, <span class="title class_">BrowserWindow</span> &#125; <span class="keyword">from</span> <span class="string">&quot;electron&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UpdateManager</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./update&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createWindow</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> win = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  win.<span class="title function_">loadFile</span>(<span class="string">&quot;index.html&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿™é‡Œå¼€å§‹æ˜¯æ–°å¢çš„</span></span><br><span class="line">  <span class="keyword">if</span> (app.<span class="property">isPackaged</span>) &#123;</span><br><span class="line">    <span class="title class_">UpdateManager</span>.<span class="title function_">getInstance</span>().<span class="title function_">init</span>(win);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ–°å¢ç»“æŸ</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">whenReady</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">createWindow</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å†é€šè¿‡ <code>preload.ts</code> æ¥é€š electron api ä¸å‰ç«¯</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; contextBridge, ipcRenderer &#125; <span class="keyword">from</span> <span class="string">&quot;electron&quot;</span>;</span><br><span class="line"></span><br><span class="line">contextBridge.<span class="title function_">exposeInMainWorld</span>(<span class="string">&quot;electronAPI&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">logUpdateMsg</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    ipcRenderer.<span class="title function_">on</span>(<span class="string">&quot;update-message&quot;</span>, <span class="keyword">function</span> (<span class="params">event, args</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">        <span class="string">&quot;ipcRenderer,update-message,message:&quot;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(args.<span class="property">message</span>)</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">if</span> (<span class="string">&quot;update-not-available&quot;</span> === args.<span class="property">cmd</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ipcRenderer,update-not-available&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;update-available&quot;</span> === args.<span class="property">cmd</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ipcRenderer,update-available&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;update-downloaded&quot;</span> === args.<span class="property">cmd</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ipcRenderer,update-downloaded&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;error&quot;</span> === args.<span class="property">cmd</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ipcRenderer,error&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">checkUpdate</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    ipcRenderer.<span class="title function_">send</span>(<span class="string">&quot;checkForUpdate&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¹‹ååœ¨å‰ç«¯é¡µé¢åˆé€‚çš„åœ°æ–¹è°ƒç”¨<code>window.electronAPI.checkUpdate()</code>å³å¯å®Œæˆæ›´æ–°ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œè‡ªåŠ¨æ›´æ–°èƒ½åŠ›åœ¨ mac ä¸Šæ˜¯éœ€è¦ä»˜è´¹æ³¨å†Œæˆå¼€å‘è€…è·å¾—è¯ä¹¦åæ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œæ‰€ä»¥ç›®å‰æ— æ³•åœ¨ mac ä¸Šæ­£å¸¸ä½¿ç”¨ã€‚</p>
</blockquote>
<p>æ­¤æ—¶æˆ‘ä»¬çš„ä»£ç å±‚é¢å·²ç»æ”¯æŒäº†é…åˆ<code>electron-release-server</code>çš„æ›´æ–°æœåŠ¡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æŠŠåŒ…å«æ›´æ–°èƒ½åŠ›çš„ä»£ç åŒæ­¥åˆ°<code>electron-release-server</code>ä¸Šå¹¶ä¸‹è½½ï¼Œå†è¿›è¡Œæ–°ç‰ˆæœ¬çš„ä¸Šä¼ å³å¯å®Œæˆæ•´å¥—æ›´æ–°çš„æµç¨‹ã€‚</p>
<blockquote>
<p>electron-forge æä¾›äº†é…å¥— electron-release-server çš„å‘å¸ƒæ’ä»¶ <a target="_blank" rel="noopener" href="https://www.electronforge.io/config/publishers/electron-release-server">@electron-forge&#x2F;publisher-electron-release-server</a>å¯ä»¥é€šè¿‡ <code>electron-forge publish</code> å‘½ä»¤å³å¯å®Œæˆå‘å¸ƒã€‚</p>
</blockquote>
<h1 id="å››ã€ä¸šåŠ¡ä»£ç æ„å»º"><a href="#å››ã€ä¸šåŠ¡ä»£ç æ„å»º" class="headerlink" title="å››ã€ä¸šåŠ¡ä»£ç æ„å»º"></a>å››ã€ä¸šåŠ¡ä»£ç æ„å»º</h1><p>è‡³æ­¤æˆ‘ä»¬å·²ç»å®Œæˆäº†æœ€åŸºç¡€çš„è®¾æ–½çš„å»ºè®¾ï¼Œä¸€ä¸ª electron é¡¹ç›®å·²ç»èƒ½é¡ºåˆ©è¿›è¡Œå¼€å‘ã€å‘å¸ƒã€ä¸‹è½½ã€æ›´æ–°ã€‚ä¸‹ä¸€æ­¥å°±å¯ä»¥è¿›å…¥åˆ°ä¸šåŠ¡çš„å¼€å‘äº†ã€‚ä¸šåŠ¡æœ¬èº«çš„å¤æ‚åº¦å¯¼è‡´å‰é¢å¼€å‘æ—¶ä½¿ç”¨çš„è¿™ç§ä¸€ä¸ªæ–‡ä»¶çš„æ–¹å¼éœ€è¦è¢«æ‹“å±•æˆå¤šæ–‡ä»¶ã€å¤šåŒ…å¼•å…¥çš„å¼€å‘å½¢å¼ï¼Œæ‰€ä»¥ä¸ºé¡¹ç›®é…ç½®æ‰“åŒ…æ–¹å¼ä¹Ÿå°†æˆä¸ºè¿™ä¸ªé¡¹ç›®åŸºç¡€è®¾æ–½çš„ä¸€éƒ¨åˆ†ã€‚  </p>
<p>å…ˆç®€å•åˆ†æä¸€ä¸‹é¡¹ç›®çš„æƒ…æ™¯ï¼Œç›®å‰é¡¹ç›®ä¸­çš„ä»£ç æ ¹æ®è¿è¡Œç¯å¢ƒå¯ä»¥åˆ†æˆä¸¤éƒ¨åˆ†ã€‚  </p>
<p>ç¬¬ä¸€éƒ¨åˆ†æ˜¯åœ¨ node runtime é‡Œè¿è¡Œçš„ä»¥ <code>index.ts</code> ä¸ºå…¥å£çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬ <code>index.ts</code>ã€<code>preload.ts</code>ã€<code>update.ts</code>ã€‚</p>
<p>ç¬¬äºŒéƒ¨åˆ†å®åœ¨ chromium runtime é‡Œè¿è¡Œçš„ä»¥ <code>index.html</code> ä¸ºå…¥å£çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬ <code>index.html</code> å’Œå®ƒå¼•ç”¨çš„èµ„æºæ–‡ä»¶ï¼ˆjsã€cssï¼‰ã€‚</p>
<p>è¿™ä¸¤è€…çš„æ‰“åŒ…åº”è¯¥æ˜¯åˆ†å¼€çš„ï¼Œå‰è€…æ›´åƒæ˜¯æˆ‘ä»¬å¹³æ—¶å†™ node åº”ç”¨æ—¶çš„æ‰“åŒ…æ–¹æ¡ˆï¼Œåè€…æ›´åƒæ˜¯æˆ‘ä»¬å†™å‰ç«¯åº”ç”¨çš„æ‰“åŒ…æ–¹æ¡ˆã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å°†ä¸¤ä»½ä»£ç å­˜å‚¨åˆ°ä¸¤ä¸ªä¸åŒçš„æ–‡ä»¶å¤¹ä»¥è¿›è¡ŒåŒºåˆ†ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•å»ºç«‹æ–‡ä»¶å¤¹ <code>src/client</code>ä¸ <code>src/server</code>ï¼Œå…¶ä¸­ <code>src/client</code> ç”¨äºå­˜æ”¾ chromium runtime ä»£ç ï¼Œ<code>src/server</code> ç”¨äºå­˜æ”¾ node runtime ä»£ç ã€‚</p>
<h2 id="4-1-Node-Runtime-ä»£ç æ„å»º"><a href="#4-1-Node-Runtime-ä»£ç æ„å»º" class="headerlink" title="4.1 Node Runtime ä»£ç æ„å»º"></a>4.1 Node Runtime ä»£ç æ„å»º</h2><p>Node Runtime ä»£ç çš„æ„å»ºæ›´é€‚åˆ bundless çš„æ¨¡å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ def è¿›è¡Œæ„å»ºã€‚</p>
<ol>
<li>åœ¨ package.json ä¸­å£°æ˜ <code>rainaConfig.type</code> ä¸º <code>npm</code>ï¼ˆå› ä¸ºç›®å‰ type å­—æ®µåªæ”¯æŒ <code>page</code> ä¸ <code>npm</code>ï¼‰</li>
<li>æ–°å»º rainaConfig.js, å†™å…¥å†…å®¹:<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">bundleless</span>: &#123;</span><br><span class="line">      <span class="attr">enable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">sourceDir</span>: <span class="string">&quot;src/server&quot;</span>,</span><br><span class="line">      <span class="attr">outputDir</span>: <span class="string">&quot;dist/server&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>æ‰§è¡Œå‘½ä»¤ <code>raina dev</code>ï¼Œå³å¯çœ‹åˆ°åœ¨ <code>dist/server</code> ç›®å½•ä¸‹ç”Ÿæˆäº†å¯¹åº”çš„ç¼–è¯‘åçš„æ–‡ä»¶</li>
</ol>

        </div>

    

</div>
                <div class="footer">
    <span>Copyright Â© 2022 æƒ³è‡ªç”±</span>
    <span>Theme Designed By <a target="_blank" href="https://zheli.design/one-paper">é€™æè¨­è¨ˆ</a></span>
</div>


<link rel="stylesheet" href="/css/a11y-dark.min.css">


<script src="/js/highlight.min.js"></script>


<script src="/js/highlightjs-line-numbers.js"></script>


<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>

            </div>
        </div>
    </body>
</html>